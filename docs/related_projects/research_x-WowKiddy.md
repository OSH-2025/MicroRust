# 调研报告

## 小组成员

* 余淼
* 顾荣健
* 毛骏源
* 王香雯
* 刘卓

## 目录

* [项目概述](#项目概述)
* [项目背景](#项目背景)
  * [分布式文件系统](#分布式文件系统)
    * [数据存储方式](#数据存储方式)
    * [一个典型的分布式文件系统GFS](#一个典型的分布式文件系统GFS)
  * [一致性问题](#一致性问题)
    * [数据一致性问题](#数据一致性问题)
      * [CAP特性](#CAP特性)
      * [强一致性与弱一致性](#强一致性与弱一致性)
    * [事务一致性问题](#事务一致性问题)
      * [原子操作与事务的原子性、隔离性](#原子操作与事务的原子性、隔离性)
      * [ACID特性](#ACID特性)
      * [隔离性](#隔离性)
    * [数据一致性问题的解决办法](#数据一致性问题的解决办法)
      * [CRDT理论](#CRDT理论)
      * [Paxos算法](#Paxos算法)
  * [数据加密](#数据加密)
    * [SSL加密](#SSL加密)
    * [HTTPS](#HTTPS)
    * [ssh加密](#ssh加密)
  * [Ray分布式计算框架](#Ray分布式计算框架)
    * [Ray编程模型](#Ray编程模型)
    * [Ray计算模型](#Ray计算模型)
    * [其他分布式计算框架](#其他分布式计算框架)
  * [图数据库](#图数据库)
    * [图数据库的关键概念](#图数据库的关键概念)
    * [已有的图数据库](#已有的图数据库)
      * [Neo4j](#Neo4j)
      * [Microsoft Azure Cosmos DB](#Microsoft-Azure-Cosmos-DB)
* [立项依据](#立项依据)
* [前瞻性/重要性分析](#前瞻性/重要性分析)
  * [数据一致性方向](#数据一致性方向)
  * [数据加密方向](#数据加密方向)
  * [图数据库方向](#图数据库方向)
  * [网页可视化方向](#网页可视化方向)
* [相关工作](#相关工作)
  * [数据加密方面](#数据加密方面)
    * [ceph加密与解密](#ceph加密与解密)
    * [对象网关加密](#对象网关加密)
    * [OSD端加密](#OSD端加密)
    * [HDFS透明加密](#HDFS-透明加密)
    * [eCryptfs 加密文件系统](#eCryptfs-加密文件系统)
  * [Ray分布式计算框架方面](#Ray分布式计算框架方面)
  * [图数据库方面](#图数据库方面)
    * [JanusGraph](#JanusGraph)
    * [NebulaGraph](#NebulaGraph)
  * [实现网页可视化方面](#实现网页可视化方面)
    * [WowKiddy和TOBEDONE](#WowKiddy和TOBEDONE)
    * [基于NebulaGraph的3D展示](#基于NebulaGraph的3D展示)
* [参考文献](#参考文献)

## 项目概述

基于2022年项目x-Wowkiddy和x-TOBEDONE进行各方面优化，主要包括数据安全性问题、数据一致性问题，尝试选用更好的数据库改进框架，以期获得更好的性能，实现高效的图文件系统，并改进网页端可视化。

## 项目背景

### 分布式文件系统

分布式文件系统是将数据分布式地存储在不同节点上的文件系统，既是存储数据，我们首先从三种数据存储方式出发：

#### 数据存储方式

1.文件存储：数据以文件的形式存储和访问，按照目录结构进行组织。常用的NFS、CIFS、ftp都是基于文件存储的。

2.块存储：数据以卷或者硬盘的形式存储，按字节来访问，对块存储而言，所存的是不可知的，它只负责数据的读取和写入，因此响应时间很短，适用于数据库。

3.对象存储：数据以对象的形式存储，一个对象是由数据、元数据和一个唯一的标识符组成的，所谓元数据即是指数据的属性内容，比如文件大小，修改时间，存储路径等。而通过唯一标识可以实现对数据的访问。对象存储可以非常简单的扩展到超大规模，适用于数据量大、增长快的数据，如：图片、视频等。

![41824d7b5f2aac7f3b7b236d23189e1d.png](https://s1.imagehub.cc/images/2023/04/08/41824d7b5f2aac7f3b7b236d23189e1d.png)

可以对块存储和对象存储进行一下比较：

块存储如：FAT32文件系统，直接将文件的元数据和数据一起存储，存储过程先将文件按照文件系统的最小块分割，再写入硬盘，并不区分数据与元数据。在分割出来的每一个块中会指明下一个块的地址，只能顺序的读取，因此读写效率受限。

而对象存储将元数据独立出来，并在其中包含每个块的存储位置，只要读取到了元数据，则能找到所有数据块，并且可以同时对数据块读取，提高了效率。

对象存储架构如下：

![f8f8379224a41ae1565295c5e761fb4e.png](https://s1.imagehub.cc/images/2023/04/08/f8f8379224a41ae1565295c5e761fb4e.png)

基于上述对象存储的特性，分布式存储常采用这种数据存储方式

#### 定义

分布式文件系统是一种将文件存储和管理扩展到多个计算节点或服务器的系统，即允许文件和数据在多个节点上分散存储，并通过网络连接的节点进行访问和操作。每个文件服务器负责存储部分文件和文件元数据，并提供文件访问和操作的接口。用户可以通过客户端应用程序连接到任何一个文件服务器，并通过文件系统接口进行文件的读取、写入、删除等操作，而无需关心实际文件存储在哪个文件服务器上。

#### 优点

（1）可扩展性很强，且系统的整体性能可以线性增长

（2）高可用性，包括整个文件系统的可用性、数据的完整性和一致性

（3）自动容错和自动负载平衡允许在成本较低的服务器上构建分布式存储系统。

（4）弹性存储，即可不中断系统运行来增加和删减存储的数据

#### 缺点

复杂性高，通信开销可能使得增加延迟，一致性管理困难，需要容错性处理，难以诊断和调试。

针对缺点中最重要的一致性问题，将在重要性中涉及。

#### 一个典型的分布式文件系统GFS

GFS是Google公司为了满足本公司需求而开发的基于Linux的专有分布式文件系统，可以部署在廉价的商务服务器上，在保证系统可靠性和可用 性的同时，大大降低了系统的成本。GFS的设计目标是高性能、高可靠、高可用性。

![a2557cb19f8888a452fcba935d8dd959.png](https://s1.imagehub.cc/images/2023/04/08/a2557cb19f8888a452fcba935d8dd959.png)

GFS系统包括master、多个chunkserver以及多个client。文件被切分为固定大小的小文件（chunk）。每个chunk创建时，master会分配一个64bit的全局唯一且不可修改的chunk handler来标志这个chunk。chunkserver负责将chunk存储在本地磁盘的Linux文件中，并通过chunk hander和byte range来读写chunk文件。为了提高可靠性，每个chunk都是多副本存储在多个chunkserver上，默认情况下是三副本。用户可以为不同名字空间下的文件配置不同的副本数。 GFS是典型的中心化架构设计，后来的很多分布式系统都参考这种架构。 

### 一致性问题

#### 定义

对分布式系统而言，CAP的C是指多副本，单操作的数据一致性

在数据库领域，ACID里的C是指单副本，多操作系统的事务一致性

因此分布式数据库的一致性，实质上是讨论数据一致性以及事物一致性两个方面

#### 数据一致性问题

包括分布式数据库在内的分布式存储系统，为了避免设备与网络的不可靠带来的影响，通常会存储多个数据副本。一份数据同时存储在多个物理副本上，自然带来了数据一致性问题：若同时存在读操作和写操作，数据一致性如何保证？

多副本数据上的一组读写策略，被称为“一致性模型”（Consistency Model）。

##### CAP特性

C:强一致性

A:可用性，客户端在任何时刻对大规模数据系统的读/写操作都应该保证在限定延迟内完成

P:分区容忍性，在大规模分布式系统中，网络分区现象，即分区间的机器无法进行网络通信的现象是必然发生的，所以系统应该能够在这种情况下仍然继续工作

##### 强一致性与弱一致性

状态、操作

状态上，操作后，所有副本一致即为强一致性，不一致则为若一致性

强一致性：例如MySQL的全同步复制

![4a8c455f26202e5ad3c5385321618b6d.png](https://s1.imagehub.cc/images/2023/04/08/4a8c455f26202e5ad3c5385321618b6d.png)

问题：性能差、可用性差

弱一致性：例如NoSQL的最终一致性，在主副本执行写操作并反馈成功后，不要求其他副本立刻一致，但一段时间后最终一致

#### 事务一致性问题

事务:是由多个操作构成的序列

##### 原子操作与事务的原子性、隔离性

原子操作：原子操作是不可中断的，不会出现竞争现象。原子操作自带了线程安全的保证，即最严格的隔离级别的可串行化，所以我们在编程时不需要加锁保护临界区。所以原子操作包括了原子性和隔离性

分布式数据库相对内存来说非常慢，可串行化操作磁盘难以接受，所以隔离性要在性能和正确性之间平衡

##### ACID特性

A:原子性，实现依赖于隔离性的并发控制技术和持久性的日志技术

C:一致性，“事务”的整体目标

I:隔离性：多事务并发执行的结果和串行执行结果完全相同

D:持久性：一旦事务提交，它对数据的改变将永久保留，不会受到任何系统故障的影响

##### 隔离性

隔离性是事务的核心，降低隔离级别，就是在正确性上妥协从而获得更好的性能

#### 数据一致性问题的解决办法

##### CRDT理论

CRDT，全称无冲突复制数据类型

##### Paxos算法

Paxos算法是Lamport提出的一种基于消息传递的分布式一致性算法。

### 数据加密

#### SSL加密

SSL是一种为网络通信提供安全以及数据完整性的安全协议，它在传输层对网络进行加密。它主要是分为两层：

SSL记录协议：为高层协议提供安全封装、压缩、加密等基本功能
SSL握手协议：用于在数据传输开始前进行通信双方的身份验证、加密算法的协商、交换密钥
OpenSSL是SSL的开源实现，是作为密码学的安全开发包，提供相当强大全面的功能，囊括了主要的密码算法、常用的密钥和证书封装管理功能以及SSL协议，并提供了丰富的应用程序供测试或其它目的使用。它一共提供了8中对称加密算法和4中非对称加密算法。

SSL会话主要分为三步：
1.客户端向服务器端索要并验正证书；
2.双方协商生成“会话密钥”；对成密钥
3.双方采用“会话密钥”进行加密通信；

#### HTTPS

HTTP是目前互联网上应用最为广泛的一种网络协议，但是HTTP协议以明文的方式发送内容，不提供任何数据加密，攻击者能够很轻易通过抓包的方式截取传输内容并读懂其中的信息，所以HTTP不适合传输一些比较私密的信息，为了解决HTTP这一缺陷，HTTPS协议出现。HTTPS是在HTTP的基础上加入SSL协议。传输以密文传输，保证数据传输的安全以及确认网站的真实性（数字证书）。

#### 缺点

HTTPS由于使用了SSL(包括TLS)而变得安全可靠，但是SSL由于要进行加密处理会导致整个通信变慢，频繁的加密、解密会消耗服务端和客户端的硬件资源。
SSL不仅会导致通信慢，还会由于大量消耗CPU和内存等资源，导致整个处理速度变慢，和HTTP相比，网络负载可能可能会变慢2到100倍

#### ssh加密

SSH是Secure Shell的缩写，也叫做安全外壳协议。SSH的主要目的是实现安全远程登录。
使用范围最广泛的是开源实现OpenSSH。

SSH的加密原理中，使用了RSA非对称加密算法。
整个过程是这样的：
（1）远程主机收到用户的登录请求，把自己的公钥发给用户。
（2）用户使用这个公钥，将登录密码加密后，发送回来。
（3）远程主机用自己的私钥，解密登录密码，如果密码正确，就同意用户登录。

私钥是Server端独有，这就保证了Client的登录信息即使在网络传输过程中被窃据，也没有私钥进行解密，保证了数据的安全性，这充分利用了非对称加密的特性。

### Ray分布式计算框架

Ray是UC Berkeley RISELab推出的高性能分布式执行框架，它使用了和传统分布式计算系统不一样的架构和对分布式计算的抽象方式，具有比Spark更优异的计算性能，是一种通用的集群计算框架，既支持模型的训练，又支持对环境的仿真或与环境的交互，还支持模型服务。

#### Ray编程模型

**Ray编程模型**是指Ray框架基于任务和行动器这两个重要需求所向用户提供的一套API及其编程范式。下表展示了Ray提供的核心API。

任务是指在无状态的工作器中执行的远程函数。远程函数被调用时会立即返回一个future对象，而真正的返回值可以通过ray.get(<future对象>)的方式来获取。**这样的编程模型既允许用户编写并行计算代码，同时又提醒用户要关注数据之间的依赖性。**

#### Ray计算模型

* Ray产生的背景:由于AI和大数据的快速发展，对于应用和硬件能力的要求提出了更高的挑战。

* Ray的特点:分布式异步调用,内存调度,Pandas/Numpy的分布式支持,支持python,整体性能出众

* 基本的软件框架

  Ray的架构由应用层和系统层组成，其中应用层实现了Ray的API,作为前端供用户使用，而系统层则作为后端来保障Ray的高扩展性和容错性，整体框架如下

![img](https://pic2.zhimg.com/80/v2-689ccf19063644dc49b077914b8d5b41_1440w.webp)

GCS 作为集中的服务端，是 Worker 之间传递消息的纽带。每个 Server 都有一个共用的 Object Store，也就是用 Apache Arrow/Plasma 构建的内存数据。 Local Scheduler 是 Server 内部的调度（单机调度），同时通过 GCS 来和其他 Server 上的 Worker 通信。Object Store 之间也有通信，作用是传递 Worker 之间的数据。

Local Scheduler，即Raylet，本地调度核心

**调度过程：任务创建后，首先向本地调度器提交任务，大多数情况下任务将在本地被调度。若没有资源，局部调度器会向全局调度器传递任务，向GCS传递任务信息，然后全局调度器会选择等待时间最短的、有足够资源的节点来执行任务**

![img](https://pic1.zhimg.com/80/v2-2580040deb0f1524fd3905919b271cd4_1440w.webp)

任务定义、提交、远程提交过程:0.定义远程函数1.提交任务2.提交任务到全局3.检查对象表4.执行全局调度5.检查任务输入6.查询缺失输入7.对象复制8.执行局部调度9.访问对象存储器

获取任务执行结果过程:1.调教get请求2.注册回调函数3.任务执行完毕4.将对象同步到GCS 5.出发回调函数6.执行回调函数7.返回用户程序

#### 其他分布式计算框架

* Dask:Dask的核心时弥补python在数据科学中的不足，主要是性能上。python单机的能力不够支持大数据集的快速计算。**Dask的目标是为了弥补Python在数据科学上的不足，而Ray的出发点是为了加速机器学习的调优和训练的速度**。数据科学和机器学习基础以python为核心,两者都以对Python Pandas/Numpy为框架基础，但也略有不同。

### 图数据库

图数据库（graph database，GDB）是一种使用图结构进行语义查询的数据库。

图数据库中使用节点、边、属性来表示和存储数据。该系统的一个关键概念是图，其将存储中的数据项与数据节点以及节点间表示关系的边的集合进行关联，从而使用节点之间以边相连的图结构进行数据的表示。这些关系使得数据库中的数据直接链接在一起，易于检索。使用图数据库进行数据之间关系的表示非常直观，对于存储高度相连的数据非常有效。

例如：用于表示人际关系的数据库：使用传统的树形数据库很难表示错综复杂的人际关系；但使用图数据库，将每个人抽象为节点，并使用节点之间的边来表示人际关系即可高效又直观地存储数据。

图数据库属于NoSQL的一种，因此其没有特定的SQL查询语言，而是每种数据库使用一种单独的语言，如cypher、GSQL等。但这种情况在不久的将来可能会有所改变：2019 年一种名为[GQL](https://en.wikipedia.org/wiki/Graph_Query_Language)（图形查询语言）的标准语言被提出，并获得了 ISO/IEC 委员会的批准。GQL 旨在成为一种类似于 SQL 的声明性语言，但借用了当前图形查询实现（如 Cypher 和 GSQL）的功能。

![人际关系](https://s1.ax1x.com/2023/04/08/ppHVCyF.png)

#### 图数据库的关键概念

1. 节点：

   节点用来表示实体或者实例，大致相当于关系数据库中的记录。

2. 边：

   边位于两个节点之间，用来表示关系。边可以有向可以无向，例如在人际关系图中，有向边可用来表示两个人之间单向相识；在兴趣图中，无向边可以用来表示一个人对某种事件感兴趣。

3. 属性：

   属性是节点相关的信息。节点的属性反映了节点的性质与内容，可通过节点的属性进行关系的搭建与搜索。例如在人际关系图中，两个人同时认识一个人，则二人均具有“与某人相识“的属性，并可通过该属性在二人之间进行查找。

4. 路径：

   路径由至少一个节点，通过各种关系连接组成，常作为一个查询或者遍历的结果。

5. 遍历：

   对图的遍历指根据节点之间的关系，访问到所有的节点。

#### 已有的图数据库

##### Neo4j

Neo4j是一个高性能的NOSQL图形数据库，它将结构化数据存储在图上而不是表中。它是一个嵌入式的、基于磁盘的、具备完全的事务特性的Java持久化高性能引擎，该引擎具有成熟数据库的所有特性。它是一个可扩展、符合 ACID 的图形数据库，采用了高性能分布式集群架构设计，并可用于自托管和云产品。

查询语言为cypher，编写语言为java；

其社区版本免费，面对企业也有付费版本，并提供更优秀的性能与表现。

优点：

* 支持多种操作系统；
* 生态较为完整，使用量大，有较多资料和工具；
* 提供多种API接口；
* 层数较低时查找效率可观；

缺点：

* 非分布式；
* 在层数较多时查找效率低。

##### Microsoft Azure Cosmos DB

Azure Cosmos DB 是一种用于新式应用开发的完全托管的 NoSQL 数据库。 在高吞吐量、大规模的数据集上的表现良好。作为一项完全托管的服务，Azure Cosmos DB 使用自动管理、更新和修补，使你无需进行数据库管理。 它还通过经济高效的无服务器和自动缩放选项处理容量管理，这些选项可响应应用程序的需求，使容量与需求相匹配。

查询语言为Gremlin，不开源。

优点：

* 支持多种操作系统；
* 模拟器在本地可完成大部分任务；
* 使用开源 API、多个 SDK、无架构数据和对操作数据的无 ETL 分析进行快速构建；
* 除了图之外还有多种储存模式，如常见的关系数据库等。

缺点：

* 使用云服务需要用visa信用卡进行注册；
* 图的可视化需要集成Linkurious Enterprise。

## 立项依据

如上所言，以往项目存在数据一致性问题以及没有考虑数据的安全性，鲁棒性有待提高，我们希望通过CRDT等一致性算法，以及SSL多种数据加密方法来解决这些问题。另外图文件系统在现在有着越来越多的应用范围，它的性能逐渐成为一个非常重要的指标，我们决定使用更高效的图数据库架构来进行优化，以打造一个高性能、保证数据一致性和安全性的图文件系统。

## 前瞻性/重要性分析

### 数据一致性方向

使用分布式文件系统，我们已经使用了数据分区（分布式存储）的手段，还有数据镜像未使用，同时数据镜像即复制也是实现分布式的基础。而正是由于复制产生的数据冗余，在不同节点存储的同一份数据，需要保持一致性。于是便引出了数据一致性问题。

有以下几个例子

1.电商系统一般会将热点数据缓存来减少数据库访问压力，这要求缓存和数据库数据是一致的，如果数据库数据发生变更但同步到缓存失败，这时就产生了缓存何数据库数据的不一致。

2.下单减库存有一致性的需求，如果下单了但是没减库存造成的结果是超卖；如果减库存了但下单失败会导致少卖。

3.对于图文件系统，如果分布式文件系统上文件更新（例如删除、上传、重命名），而图数据库上信息没有及时更新，就会造成错误，这就是分布式数据库的一致性问题

### 数据加密方向

保护敏感数据不被泄漏成为人们关注的热点问题。入侵者可以通过网络攻击来窃夺文件数据；而且，由于共享的需求，敏感数据会由多人访问，这也增大了泄漏的可能性。对数据或文件进行加密已经成为一种公认的比较成功的保护方法。事实上，人们早已开发了许多优秀的加密算法，如 DES、AES、RSA 等，并且有一些应用程序如 crypt 使用这些加密算法，用户通过这些工具手工地完成加密、解密的工作。由于这些应用程序操作麻烦、没有和整个系统紧密地结合而且容易受到攻击，因此一般用户并不愿意使用。

### 图数据库方向

在调研中我们看到Wowkiddy所使用的Neo4j图数据库效率较低，且不支持原生的分布式。因此考虑使用有原生分布式的图数据库进行替代，从而提高执行效率。与此同时，Wowkiddy与TOBEDONE项目中模块过多，在数据交流上会存在很大的延迟与资源浪费，因此使用全新的图数据库也可以做到提高资源利用率的结果。

模块间进行数据交流与互通时的安全性问题也是图数据库面临的重要问题之一。通过使用新的图数据库，优化图数据库结构，并增加加密、解密模块可以大幅度地增加系统的安全性。

### 网页可视化方向

因大数据时代，大规模、高纬度、非结构化数据层出不穷，要将这样的数据以3D可视化形式完美的展示出来，传统的二维数据展示已难满足更多的需求。所以需结合数据实时渲染技术、空间数据可视化技术，实现数据实时图形可视化、场景化以及实时交互，通过三维虚拟现实让使用者更加方便地进行数据的理解和空间知识的呈现，应用于图文件系统的指挥监控、视景仿真及三维交互等众多功能。

图文件系统3D可视化的优势：
①信息展现范围广：使用3D图像来总结复杂的图文件系统，可以确保对关系的理解要比2D展示的图文件系统更快。
②多维度、多层次的数据展现图文件系统：将数据每一维的值分类、排序、组合和显示，这样就可以看到表示对象或事件的数据的多个属性或变量。
③更直观的数据信息展示：大数据可视化报告使我们能够用一些简短的图形就能体现那些复杂信息。丰富但有意义的图形有助于让用户快速查找文件和查看系统逻辑。

## 相关工作

### 数据加密方面

#### ceph加密与解密

对于Ceph，从应用程序到存储设备的数据链路上来看，根据对数据加密的位置，现阶段主要有以下几种加密方式。

* 客户端加密：这包括应用程序本身的加密，以及更为广泛的通用加密模块。如Linux内核的dmcrypt。这些加密都在客户端进行，意味着在网络上传送的都是加密数据，存储的也都是加密数据。

* 存储端加密：数据的加密与解密在存储端进行，存储设备负责管理密钥。在这种方法中，在网络上通过HTTP传递的都是明文数据，想要避免传递明文数据，需要使用HTTPS。

Ceph作为一个分布式存储系统，提供了存储端加密。根据用户数据在Ceph中的I/O路径，可以提供多种不同的加密方式。

#### 对象网关加密

这种方式是指客户端将数据传递到对象网关，网关将数据加密存储到Ceph集群。反之，密文数据从Ceph集群读取到对象网关，进行解密，然后传送到客户端。

对象网关加密支持以下模式的密钥管理。

1. 用户提供密钥

在这种模式下，客户端将在每次I/O操作时将密钥一起传递给Ceph。客户端需要自己负责管理这些密钥，并且需要记录对象加密时所使用的对应密钥。

1. 密钥管理服务

这种模式下允许密钥保存在某个密钥管理服务中，Ceph对象网关在需要的时候会通过统一接口去读取密钥。理论上，任何符合这个文档的密钥管理服务都能用在Ceph中，但是现在只有Barbican的集成已经完成。

Barbican是OpenStack的一个子项目，为存储安全提供密钥密码及证书管理，通过RESTful接口提供服务。Ceph对象网关使用Barbican的过程为：首先，在需要时，对象网关向Keystone请求token；拿到token后，对象网关向Barbican请求密钥，Barbican确认token是否有效，如果有效，就把对应的密钥返回给对象网关；接下来，对象网关就可以使用密钥进行加密与解密了。

#### OSD端加密

这里所谓的OSD端加密，其实是对硬盘来进行加密的。基本原理是通过Linux内核dmcrypt模块，进行数据的加密与解密。

严格来说，dmcrypt的功能不在Ceph代码范围内，它可以被视为硬盘驱动的一部分。另外，如果使用FileStore，也可以在文件系统级别加入对数据的加密支持。

#### HDFS 透明加密

透明加密是一种文件加密技术。它对使用者来说是无感知的。当使用者在打开或编辑指定文件时，系统将自动对未加密的文件进行加密，对已加密的文件自动解密。文件在硬盘上是密文，在内存中是明文。一旦离开使用环境，由于应用程序无法得到自动解密的服务而无法打开，从而起来保护文件内容的效果。

透明加密的分类：

* 应用程序级加密：这是最安全和最灵活的方法。应用程序对加密的内容有最终的控制，并且可以精确地反映用户的要求。但是，编写应用程序来做到这一点很困难。而且对于不支持加密的现有应用程序的客户来说，可能就要更新换客户端了。

* 数据库级加密：类似于应用程序级加密的属性。大多数数据库供应商提供某种形式的加密。但是可能会有性能问题，且索引不能被加密。

* 文件系统级加密：该选项提供了高性能，应用程序透明性，并且通常易于部署。但是，它无法模拟某些应用程序级别的策略。例如，多租户应用程序可能希望基于最终用户进行加密。数据库可能需要对存储在单个文件中的每个列进行不同的加密设置。

* 磁盘级加密：易于部署和高性能，但也相当不灵活。只有真正防止物理盗窃的作用。

#### eCryptfs 加密文件系统

eCryptfs堆叠在底层文件系统之上，用户空间的eCryptfs daemon和内核的keyring共同负责秘钥的管理，当用户空间发起对加密文件的写操作时，由VFS转发给eCryptfs ，eCryptfs通过kernel Crypto API（AES,DES）对其进行加密操作，再转发给底层文件系统。读则相反。

eCryptfs 的加密设计受到OpenPGP规范的影响，其核心思想有以下两点：

1. 文件名与内容的加密

eCryptfs 采用对称秘钥加密算法来加密文件名及文件内容（如AES，DES等），秘钥FEK（FileEncryption Key）是随机分配的。相对多个加密文件使用同一个FEK，其安全性更高。

2. FEK的加密

eCryptfs 使用用户提供的口令（Passphrase）、公开密钥算法（如 RSA 算法）或 TPM（Trusted Platform Module）的公钥来加密保护FEK。加密后的FEK称EFEK（Encrypted File Encryption Key），口令/公钥称为 FEFEK（File Encryption Key Encryption Key）。

#### 缺点

1. 性能问题

堆叠式文件系统对于性能的影响是无法忽略的，并且eCryptfs还涉及了加解密的操作，其性能问题应该更为突出。从公开资料显示，对于读操作影响较小，写操作性能影响很大。这是因为，eCryptfs的Page cache中存放的是明文，对于一段数据，只有首次读取需要解密，后续读操作将没有这些开销。但对于每次写入的数据，涉及的加密操作开销就会较大。

1. 安全隐患

eCryptfs的Page cache中存放的是明文，如果用户空间的权限设置不当或被攻破，那么这段数据将会暴露给所有应用程序。这部分是使用者需要考虑优化的方向。

### Ray分布式计算框架方面

  Ray一大应用场景是，监督学习，每一条数据伴随对应标签存在，监督学习目的是构建数据->标签的模型，最主流的模型是深度神经网络。Ray所面临的任务涵盖了从轻量级、无状态的计算任务（例如仿真）到长时间运行的、有状态的计算任务（例如训练）。为了满足这些任务的需求，Ray实现了一套统一的接口，这套接口既能表达**基于任务的并行计算**(task-parallel)，又能表达**基于行动器的并行计算**(actor-based)。前者使得Ray能高效地、动态地对仿真、高维状态输入处理（如图像、视频）和错误恢复等任务进行负载均衡，后者行动器的设计使得Ray能有效地支持有状态的计算，例如模型训练、与客户端共享可变状态（如参数服务器）。在我们的项目中，我们准备使用Ray分布式计算框架来辅助和加速给文件打标签的过程。

### 图数据库方面

#### JanusGraph

JanusGraph是The Linux Foundation旗下的开源分布式图数据库。JanusGraph 支持各种存储后端，例如通过使用 Apache Cassandra 作为存储后端，JanusGraph可以开箱即用地扩展到多个数据中心。支持ACID和最终一致性，并支持各种可视化工具。使用Java API与Tinkertop API。

查询语言为Gremlin，编写语言为Java。

根据Apache 2协议开源，所有功能均免费开源。

优点：

* 支持各种操作系统；
* 提供docker image；
* 支持分布式与各种可视化；
* 生态比较完整。

缺点：

* 使用Java编写，对超大量的数据效率不佳；
* 查询语言为Gremlin，学习成本较高。

#### NebulaGraph

NebulaGraph是一个开源的分布式图数据库，专为毫秒级延迟的超大规模图而构建。提供毫秒级延迟、高可用性和数据安全性。

查询语言为nGQL（类SQL查询语言），编写语言为C++。根据Apache 2协议开源。

优点：

* 使用C++开发，查询效率高；
* 生态多样化，可与其它产品整合为一体；
* 使用nGQL语言，且有中文文档，学习成本低；
* 支持分布式；
* 能实现较为基础的3D结构展示

缺点：

* 只支持Linux系统。

### 实现网页可视化方面

#### WowKiddy和TOBEDONE

WowKiddy和TOBEDONE在DisGraFS等组的基础上分别做了优化，两组都有不同的创新点。Wowkiddy实现了主动缓存功能对读取速度的、前端网页预览、容器化部署和监控功能的优化；TOBEDONE基于DisGraFS搭建了完全的存储集群，增强运维功能（实现监控功能），基于dontpanic并实现了网页端的完全操作，增强了权限管理，对文件进行冗余，此外加入了监控可视化，容器化部署，前端美化等功能。
改进
Wowkiddy实现了前端展示，但是未实现网页端，我们希望将Wowkiddy的成果通过网页端的形式实现，TOBEDONE并未解决数据的一致性问题，在文件上传和下载中只能支持1MB以下大小的文件，安全性问题仍需优化。

我们将整合两组并做出相对应的优化和3D可视化

#### 基于NebulaGraph的3D展示

在NebulaGraph中创建图数据库、插入数据和逻辑联系后配置使用可视化插件来实现图数据结构基础的3D展示
![iRd17d.png](https://i.328888.xyz/2023/04/08/iRd17d.png)



## 参考文献

[Ray分布式计算框架](https://arxiv.org/pdf/1712.05889.pdf)

[分布式存储ceph：加密](https://blog.csdn.net/cyq6239075/article/details/107429839)

[HDFS：透明加密](https://blog.csdn.net/wannuoge4766/article/details/105160108)

[图数据库历史](https://docs.nebula-graph.com.cn/3.4.1/1.introduction/0-1-graph-database/)

[图数据库排名](https://db-engines.com/en/ranking/graph+dbms)

[图数据库介绍](https://www.geeksforgeeks.org/introduction-to-graph-databases/#)

[Neo4j JanusGraph NebulaGraph 比较](https://db-engines.com/en/system/JanusGraph%3BNebulaGraph%3BNeo4j)

[nebulagraph 特点](https://docs.nebula-graph.com.cn/3.4.1/1.introduction/1.what-is-nebula-graph/)

[分布式存储](http://www.360doc.com/content/16/0812/11/16915_582670782.shtml)
[分布式系统的事务处理](https://coolshell.cn/articles/10910.html)[Google Spanner](https://cloud.google.com/blog/products/databases/why-you-should-pick-strong-consistency-whenever-possible)

[事务的隔离性](https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tr-95-51.pdf)

[x-WowKiddy/CRDT调研报告](https://github.com/OSH-2022/x-WowKiddy/blob/main/docs/research/CRDT调研报告.md)

[x-WowKiddy/分布式文件系统的数据一致性以及Paxos](https://github.com/OSH-2022/x-WowKiddy/blob/main/docs/research/分布式文件系统的数据一致性.md)